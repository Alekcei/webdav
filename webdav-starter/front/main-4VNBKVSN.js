import{A as y,B as J,C as K,D,E as I,F as x,G as O,H as X,I as Z,J as m,K as N,L as E,M as ee,N as k,O as te,P as ne,Q as ie,R as h,S as oe,T as re,a as S,b as A,c as B,d as q,e as w,f as U,g as f,h as b,i as Q,j as V,k as W,l as v,m as _,n as F,o as c,p as M,r as P,s as $,t as z,u as l,v as a,w as u,x as p,y as G,z as Y}from"./chunk-PLY572PE.js";var j=class{constructor(){this.baseUrl="",this.user="",this.password=""}},d=(()=>{let n=class n{constructor(t,e){this.http=t,this.cfg=e,this.baseUrl="http://localhost:3505",this.user="alekseisosnovskikh",this.password="hqsfkdtmarovalyu",console.log("cfg  ",e)}propfind(t,e){let i=`<?xml version="1.0" encoding="utf-8" ?>
 <D:propfind xmlns:D="DAV:">
  <D:prop>
`;return i+=`<D:creationdate/>
<D:displayname/>
<D:getcontentlength/>
<D:getcontenttype/>
<D:getetag/>
<D:getlastmodified/>
<D:resourcetype/>
`,i+=`  </D:prop>
 </D:propfind>`,this.sendRequest({method:"PROPFIND",uri:t,contentType:"text/xml",responseType:"text",headers:{Depth:e},body:i}).pipe(A(r=>{let s=r,T=new DOMParser().parseFromString(s.body,"text/xml").firstElementChild;if(T==null)return[];let L=[];return T.childNodes.forEach(C=>{if(!C.nodeName.endsWith("response"))return;let R=this.toObject(C);R.current=R.href.replaceAll(/\/$/g,"")==t.replaceAll(/\/$/g,""),L.push(R)}),L.map(C=>this.toFileInfo(C))}))}sendRequest(t){let e=new N;this.cfg?.password&&this.cfg?.user&&(e=e.append("Authorization","Basic "+btoa(this.cfg?.user+":"+this.cfg?.password))),t.contentType&&(e=e.append("Content-Type",t.contentType));for(let i in t.headers)e=e.append(i,t.headers[i]);return this.http.request(new E(t.method,(this.cfg?.baseUrl||"")+t.uri,t.body,{responseType:"text",headers:e})).pipe(B(i=>i.type!==0))}toFileInfo(t){return{href:t.href,status:t.propstat.status,contentLength:parseInt(t.propstat.prop.getcontentlength||"0"),mimeType:t.propstat.prop.getcontenttype||"",displayName:t.propstat.prop.displayname,etag:t.propstat.prop.getetag,isFolder:t.propstat.prop.resourcetype?.collection!=null,current:t.current||!1}}toObject(t){let e={};return t.childNodes.length<=1?t.textContent:(t.childNodes.forEach(i=>{if(i.nodeName.endsWith("#text"))return;let r=i.nodeName.split(":")[1];i.childNodes.length<=1?e[r]=i.textContent:e[r]=this.toObject(i)}),e)}move(t,e){}delete(t){}copy(t,e){}get(t){let e=new N;return e=e.append("Authorization","Basic "+btoa("ivanov:123456")),this.http.request(new E("GET",this.baseUrl+"/"+t,null,{headers:e})).pipe(B(i=>i.type!==0))}};n.\u0275fac=function(e){return new(e||n)(U(ee),U(j,8))},n.\u0275prov=q({token:n,factory:n.\u0275fac});let o=n;return o})();var H=(()=>{let n=class n{constructor(t){this.route=t}toHome(){this.current?.isFolder&&this.current?.href!="/"&&this.route.navigateByUrl("/")}toUp(){this.current?.isFolder&&this.current.href!="/"&&this.route.navigateByUrl(this.current.href.replaceAll(/\/[^/]*\/?$/g,""))}};n.\u0275fac=function(e){return new(e||n)(c(h))},n.\u0275cmp=f({type:n,selectors:[["left-panel"]],inputs:{current:"current"},standalone:!0,features:[D],decls:13,vars:2,consts:[[1,"go-up",3,"click"],["xmlns","http://www.w3.org/2000/svg"],["d","M12 4V14M12 4L8 8M12 4L16 8","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[3,"click"]],template:function(e,i){e&1&&(l(0,"div",0),p("click",function(){return i.toUp()}),l(1,"b"),y(2,"\u041D\u0430 \u0432\u0435\u0440\u0445"),a(),V(),l(3,"svg",1),u(4,"path",2),a()(),W(),u(5,"br")(6,"br"),l(7,"b",3),p("click",function(){return i.toHome()}),y(8,"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"),a(),u(9,"br"),l(10,"b"),y(11,"\u041C\u0435\u0441\u0442\u0430"),a(),u(12,"br")),e&2&&P("active",(i.current==null?null:i.current.href)!="/")},dependencies:[m],styles:["[_nghost-%COMP%]{background:#F3F2F2;width:130px;min-width:100px;border-right:1px solid #C7C7C7}.arrow-up[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#651111}.go-up[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;cursor:pointer;display:inline-flex;flex-direction:row;align-items:center;justify-content:center;stroke:#000}.go-up[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:18px}.go-up[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.go-up[_ngcontent-%COMP%]:not(.active){color:gray;cursor:default}.go-up[_ngcontent-%COMP%]:not(.active)   path[_ngcontent-%COMP%]{stroke:gray}"]});let o=n;return o})();var le=(()=>{let n=class n{constructor(t){this._viewContainer=t}ngOnInit(){}close(){if(this.cmpRef){this.cmpRef.destroy(),this.cmpRef=void 0;return}}click(t){return S(this,null,function*(){if(t.preventDefault(),this.cmpRef){this.cmpRef.destroy(),this.cmpRef=void 0;return}let{FilePopupComponent:e}=yield import("./chunk-F35XHBGW.js");this.cmpRef=this._viewContainer.createComponent(e),this.cmpRef.instance.event=t})}ngOnDestroy(){this.cmpRef&&(this.cmpRef.destroy(),this.cmpRef=void 0)}};n.\u0275fac=function(e){return new(e||n)(c($))},n.\u0275dir=Q({type:n,selectors:[["","file-popup",""]],hostBindings:function(e,i){e&1&&p("click",function(){return i.close()},!1,v)("contextmenu",function(s){return i.close(s)},!1,v)("keydown.escape",function(s){return i.close(s)},!1,v)("contextmenu",function(s){return i.click(s)})},inputs:{fileInfo:"fileInfo",filePopup:["file-popup","filePopup"]}});let o=n;return o})();var Ce=["preview"],pe=(()=>{let n=class n{constructor(t){this.route=t,this.title="webdav"}ngOnInit(){let t=(this.baseUrl||"")+"/mimetype?icon-file&mimetype="+(this.fileInfo.isFolder?"folder":encodeURIComponent(this.fileInfo.mimeType));this.preview.nativeElement.src=t}dblclick(){if(this.fileInfo.isFolder){this.route.navigateByUrl(this.fileInfo.href);return}var t=this.fileInfo.href;window.open((this.baseUrl||"")+t,"Download")}getFileUrl(){return(this.baseUrl||"")+this.fileInfo.href}onFocus(){this.focus=!0}onFocusOut(){this.focus=!1}errorLoapPreview(){this.preview.nativeElement.src="favicon.ico"}};n.\u0275fac=function(e){return new(e||n)(c(h))},n.\u0275cmp=f({type:n,selectors:[["file-item"]],viewQuery:function(e,i){if(e&1&&x(Ce,7,_),e&2){let r;I(r=O())&&(i.preview=r.first)}},hostVars:2,hostBindings:function(e,i){e&1&&p("dblclick",function(){return i.dblclick()}),e&2&&P("focus",i.focus)},inputs:{fileInfo:"fileInfo",baseUrl:"baseUrl"},decls:5,vars:2,consts:[[3,"title","focus","focusout"],["src","icons",3,"error"],["preview",""]],template:function(e,i){e&1&&(l(0,"button",0),p("focus",function(){return i.onFocus()})("focusout",function(){return i.onFocusOut()}),l(1,"img",1,2),p("error",function(){return i.errorLoapPreview()}),a(),l(3,"span"),y(4),a()()),e&2&&(Y("title",i.fileInfo.displayName.length>20?i.fileInfo.displayName:""),F(4),J(i.fileInfo.displayName))},styles:["img[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:10px}span[_ngcontent-%COMP%]{user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none;-ms-user-select:none;overflow:hidden}button[_ngcontent-%COMP%]{background:none;border:0;display:inline-flex;flex-direction:row;align-items:center;justify-content:start;width:100%;overflow:hidden}button[_ngcontent-%COMP%]:focus{outline:0}[_nghost-%COMP%]:hover   img[_ngcontent-%COMP%]{filter:brightness(1.15)}.compact[_nghost-%COMP%]   span[_ngcontent-%COMP%], .compact   [_nghost-%COMP%]   span[_ngcontent-%COMP%]{text-overflow:ellipsis;text-wrap:nowrap}.focus[_nghost-%COMP%]{background:#92B372}"]});let o=n;return o})();var be=["filesPanel"];function _e(o,n){if(o&1&&u(0,"file-item",4),o&2){let he=n.$implicit,t=G();M("fileInfo",he)("baseUrl",t.baseUrl)}}var ce=(()=>{let n=class n{constructor(t,e,i){this.route=t,this.webDav=e,this.router=i,this.title="webdav",this.baseUrl="",this.path="/",this.files=[],this.baseUrl=e.baseUrl,this.routeSubscription=this.router.events.subscribe(r=>{r instanceof ne&&(this.path=r.url,this.propfind())})}click(t){t.preventDefault()}propfind(){this.webDav.propfind(this.path,"1").subscribe(t=>{this.files=t.filter(e=>e.current?(this.current=e,!1):!0)})}get(){this.webDav.get("test/").subscribe()}ngOnDestroy(){this.routeSubscription?.unsubscribe()}onBackspace(t){this.toUp()}onMouseWheel(t){if(t.deltaY==0)return;let e=this.filesPanel.nativeElement;e.scrollTo(e.scrollLeft+t.deltaY,0)}toUp(){this.current.isFolder&&this.current.href!="/"&&this.route.navigateByUrl(this.current.href.replaceAll(/\/[^/]*\/?$/g,""))}};n.\u0275fac=function(e){return new(e||n)(c(h),c(d),c(h))},n.\u0275cmp=f({type:n,selectors:[["navigator"]],viewQuery:function(e,i){if(e&1&&x(be,7,_),e&2){let r;I(r=O())&&(i.filesPanel=r.first)}},hostBindings:function(e,i){e&1&&p("contextmenu",function(s){return i.click(s)})("keydown.backspace",function(s){return i.onBackspace(s)},!1,v)("wheel",function(s){return i.onMouseWheel(s)})},inputs:{current:"current"},decls:4,vars:2,consts:[[3,"current"],[1,"compact","files",2,"max-height","inherit"],["filesPanel",""],[3,"fileInfo","baseUrl","file-popup",4,"ngFor","ngForOf"],[3,"fileInfo","baseUrl","file-popup"]],template:function(e,i){e&1&&(u(0,"left-panel",0),l(1,"div",1,2),z(3,_e,1,2,"file-item",3),a()),e&2&&(M("current",i.current),F(3),M("ngForOf",i.files))},dependencies:[Z,H,le,pe],styles:["[_nghost-%COMP%]{display:flex;height:inherit}.compact.files[_ngcontent-%COMP%]{padding-top:5px;display:grid;width:100%;grid-template-columns:repeat(auto-fill,200px);grid-template-rows:repeat(auto-fill,35px);grid-auto-flow:column;overflow-y:hidden;overflow-x:scroll}"]});let o=n;return o})();var ae=[{path:"**",component:ce}];var ue={providers:[oe(ae)]};var fe=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=b({type:n}),n.\u0275inj=w({imports:[m]});let o=n;return o})();var me=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=b({type:n}),n.\u0275inj=w({providers:[{provide:d,useClass:d}],imports:[m,H,k,fe]});let o=n;return o})();var de=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=f({type:n,selectors:[["app-root"]],standalone:!0,features:[K([{provide:X,useValue:"/ui/"},{provide:d,useClass:d}]),D],decls:1,vars:0,template:function(e,i){e&1&&u(0,"router-outlet")},dependencies:[m,ie,me,k,re],styles:["[_nghost-%COMP%]{height:100%}"]});let o=n;return o})();te(de,ue).catch(o=>console.error(o));
