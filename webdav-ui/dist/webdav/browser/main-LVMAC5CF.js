import{A as J,B as y,C as K,D as X,E as P,F as H,G as O,H as x,I as Z,J as ee,K as m,L as E,M as j,N as te,O as k,P as ie,Q as ne,R as oe,S as h,T as re,U as se,a as L,b as V,c as U,d as A,e as b,f as N,g as f,h as _,i as Q,j as W,k as q,l as $,m as v,n as F,o as M,p,q as D,s as I,t as z,u as G,v as l,w as a,x as u,y as c,z as Y}from"./chunk-JY4NOFXB.js";var C=class{constructor(){this.baseUrl="",this.user="",this.password=""}},d=(()=>{let i=class i{constructor(e,t){this.http=e,this.cfg=t,this.baseUrl="",this.baseUrl=this.cfg?.baseUrl||""}propfind(e,t){let n=`<?xml version="1.0" encoding="utf-8" ?>
 <D:propfind xmlns:D="DAV:">
  <D:prop>
`;return n+=`<D:creationdate/>
<D:displayname/>
<D:getcontentlength/>
<D:getcontenttype/>
<D:getetag/>
<D:getlastmodified/>
<D:resourcetype/>
`,n+=`  </D:prop>
 </D:propfind>`,this.sendRequest({method:"PROPFIND",uri:e,contentType:"text/xml",responseType:"text",headers:{Depth:t},body:n}).pipe(V(r=>{let s=r,T=new DOMParser().parseFromString(s.body,"text/xml").firstElementChild;if(T==null)return[];let S=[];return T.childNodes.forEach(w=>{if(!w.nodeName.endsWith("response"))return;let B=this.toObject(w);B.current=B.href.replaceAll(/\/$/g,"")==e.replaceAll(/\/$/g,""),S.push(B)}),S.map(w=>this.toFileInfo(w))}))}sendRequest(e){let t=new E;this.cfg?.password&&this.cfg?.user&&(t=t.append("Authorization","Basic "+btoa(this.cfg?.user+":"+this.cfg?.password))),e.contentType&&(t=t.append("Content-Type",e.contentType));for(let n in e.headers)t=t.append(n,e.headers[n]);return this.http.request(new j(e.method,(this.cfg?.baseUrl||"")+e.uri,e.body,{responseType:"text",headers:t})).pipe(U(n=>n.type!==0))}toFileInfo(e){return{href:e.href,status:e.propstat.status,contentLength:parseInt(e.propstat.prop.getcontentlength||"0"),mimeType:e.propstat.prop.getcontenttype||"",displayName:e.propstat.prop.displayname,etag:e.propstat.prop.getetag,isFolder:e.propstat.prop.resourcetype?.collection!=null,current:e.current||!1}}toObject(e){let t={};return e.childNodes.length<=1?e.textContent:(e.childNodes.forEach(n=>{if(n.nodeName.endsWith("#text"))return;let r=n.nodeName.split(":")[1];n.childNodes.length<=1?t[r]=n.textContent:t[r]=this.toObject(n)}),t)}move(e,t){}delete(e){}copy(e,t){}get(e){let t=new E;return this.cfg?.password&&this.cfg?.user&&(t=t.append("Authorization","Basic "+btoa(this.cfg?.user+":"+this.cfg?.password))),this.http.request(new j("GET",(this.cfg?.baseUrl||"")+"/"+e,null,{headers:t})).pipe(U(n=>n.type!==0))}};i.\u0275fac=function(t){return new(t||i)(N(te),N(C,8))},i.\u0275prov=A({token:i,factory:i.\u0275fac});let o=i;return o})();var R=(()=>{let i=class i{constructor(e){this.route=e}toHome(){this.current?.isFolder&&this.current?.href!="/"&&this.route.navigateByUrl("/")}toUp(){this.current?.isFolder&&this.current.href!="/"&&this.route.navigateByUrl(this.current.href.replaceAll(/\/[^/]*\/?$/g,""))}};i.\u0275fac=function(t){return new(t||i)(p(h))},i.\u0275cmp=f({type:i,selectors:[["left-panel"]],inputs:{current:"current"},standalone:!0,features:[P],decls:13,vars:2,consts:[[1,"go-up",3,"click"],["xmlns","http://www.w3.org/2000/svg"],["d","M12 4V14M12 4L8 8M12 4L16 8","stroke","#000000","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[3,"click"]],template:function(t,n){t&1&&(l(0,"div",0),c("click",function(){return n.toUp()}),l(1,"b"),y(2,"\u041D\u0430 \u0432\u0435\u0440\u0445"),a(),W(),l(3,"svg",1),u(4,"path",2),a()(),q(),u(5,"br")(6,"br"),l(7,"b",3),c("click",function(){return n.toHome()}),y(8,"\u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E"),a(),u(9,"br"),l(10,"b"),y(11,"\u041C\u0435\u0441\u0442\u0430"),a(),u(12,"br")),t&2&&I("active",(n.current==null?null:n.current.href)!="/")},dependencies:[m],styles:["[_nghost-%COMP%]{background:#F3F2F2;width:130px;min-width:100px;border-right:1px solid #C7C7C7}.arrow-up[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{fill:#651111}.go-up[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;cursor:pointer;display:inline-flex;flex-direction:row;align-items:center;justify-content:center;stroke:#000}.go-up[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:18px}.go-up[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:20px;height:20px}.go-up[_ngcontent-%COMP%]:not(.active){color:gray;cursor:default}.go-up[_ngcontent-%COMP%]:not(.active)   path[_ngcontent-%COMP%]{stroke:gray}"]});let o=i;return o})();var ce=(()=>{let i=class i{constructor(e){this._viewContainer=e}ngOnInit(){}close(){if(this.cmpRef){this.cmpRef.destroy(),this.cmpRef=void 0;return}}click(e){return L(this,null,function*(){if(e.preventDefault(),this.cmpRef){this.cmpRef.destroy(),this.cmpRef=void 0;return}let{FilePopupComponent:t}=yield import("./chunk-U7EEKAQP.js");this.cmpRef=this._viewContainer.createComponent(t),this.cmpRef.instance.event=e})}ngOnDestroy(){this.cmpRef&&(this.cmpRef.destroy(),this.cmpRef=void 0)}};i.\u0275fac=function(t){return new(t||i)(p(z))},i.\u0275dir=Q({type:i,selectors:[["","file-popup",""]],hostBindings:function(t,n){t&1&&c("click",function(){return n.close()},!1,v)("contextmenu",function(s){return n.close(s)},!1,v)("keydown.escape",function(s){return n.close(s)},!1,v)("contextmenu",function(s){return n.click(s)})},inputs:{fileInfo:"fileInfo",filePopup:["file-popup","filePopup"]}});let o=i;return o})();var we=["preview"],pe=(()=>{let i=class i{constructor(e){this.route=e,this.title="webdav"}ngOnInit(){let e=(this.baseUrl||"")+"/mimetype?icon-file&mimetype="+(this.fileInfo.isFolder?"folder":encodeURIComponent(this.fileInfo.mimeType));this.preview.nativeElement.src=e}dblclick(){if(this.fileInfo.isFolder){this.route.navigateByUrl(this.fileInfo.href);return}var e=this.fileInfo.href;window.open((this.baseUrl||"")+e,"Download")}getFileUrl(){return(this.baseUrl||"")+this.fileInfo.href}onFocus(){this.focus=!0}onFocusOut(){this.focus=!1}errorLoapPreview(){this.preview.nativeElement.src="favicon.ico"}};i.\u0275fac=function(t){return new(t||i)(p(h))},i.\u0275cmp=f({type:i,selectors:[["file-item"]],viewQuery:function(t,n){if(t&1&&O(we,7,F),t&2){let r;H(r=x())&&(n.preview=r.first)}},hostVars:2,hostBindings:function(t,n){t&1&&c("dblclick",function(){return n.dblclick()}),t&2&&I("focus",n.focus)},inputs:{fileInfo:"fileInfo",baseUrl:"baseUrl"},decls:5,vars:2,consts:[[3,"title","focus","focusout"],["src","icons",3,"error"],["preview",""]],template:function(t,n){t&1&&(l(0,"button",0),c("focus",function(){return n.onFocus()})("focusout",function(){return n.onFocusOut()}),l(1,"img",1,2),c("error",function(){return n.errorLoapPreview()}),a(),l(3,"span"),y(4),a()()),t&2&&(J("title",n.fileInfo.displayName.length>20?n.fileInfo.displayName:""),M(4),K(n.fileInfo.displayName))},styles:["img[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:10px}span[_ngcontent-%COMP%]{user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none;-ms-user-select:none;overflow:hidden}button[_ngcontent-%COMP%]{background:none;border:0;display:inline-flex;flex-direction:row;align-items:center;justify-content:start;width:100%;overflow:hidden}button[_ngcontent-%COMP%]:focus{outline:0}[_nghost-%COMP%]:hover   img[_ngcontent-%COMP%]{filter:brightness(1.15)}.compact[_nghost-%COMP%]   span[_ngcontent-%COMP%], .compact   [_nghost-%COMP%]   span[_ngcontent-%COMP%]{text-overflow:ellipsis;text-wrap:nowrap}.focus[_nghost-%COMP%]{background:#92B372}"]});let o=i;return o})();var _e=["filesPanel"];function Fe(o,i){if(o&1&&u(0,"file-item",4),o&2){let ge=i.$implicit,e=Y();D("fileInfo",ge)("baseUrl",e.baseUrl)}}var ae=(()=>{let i=class i{constructor(e,t,n){this.route=e,this.webDav=t,this.router=n,this.title="webdav",this.baseUrl="",this.path="/",this.hideHiddenFile=!0,this.files=[],this.viewsFiles=[],this.baseUrl=t.baseUrl,this.hideHiddenFile=localStorage.getItem("hideHiddenFile")=="true",this.routeSubscription=this.router.events.subscribe(r=>{r instanceof ne&&(this.path=r.url,this.propfind())})}click(e){e.preventDefault()}propfind(){this.webDav.propfind(this.path,"1").subscribe(e=>{this.files=e.filter(t=>t.current?(this.current=t,!1):!0),this.resetViewsFiles()})}get(){this.webDav.get("test/").subscribe()}resetViewsFiles(){this.viewsFiles=this.files.filter(e=>!(this.hideHiddenFile&&e.displayName.startsWith(".")))}ngOnDestroy(){this.routeSubscription?.unsubscribe()}onBackspace(e){this.toUp()}onMouseWheel(e){if(e.deltaY==0)return;let t=this.filesPanel.nativeElement;t.scrollTo(t.scrollLeft+e.deltaY,0)}bigFont(e){e.preventDefault(),this.hideHiddenFile=!this.hideHiddenFile,localStorage.setItem("hideHiddenFile",String(this.hideHiddenFile)),this.resetViewsFiles()}onMouseSelected(e){console.log("",document.getSelection())}toUp(){this.current.isFolder&&this.current.href!="/"&&this.route.navigateByUrl(this.current.href.replaceAll(/\/[^/]*\/?$/g,""))}};i.\u0275fac=function(t){return new(t||i)(p(h),p(d),p(h))},i.\u0275cmp=f({type:i,selectors:[["navigator"]],viewQuery:function(t,n){if(t&1&&O(_e,7,F),t&2){let r;H(r=x())&&(n.filesPanel=r.first)}},hostBindings:function(t,n){t&1&&c("contextmenu",function(s){return n.click(s)})("keydown.backspace",function(s){return n.onBackspace(s)},!1,v)("wheel",function(s){return n.onMouseWheel(s)})("keydown.control.h",function(s){return n.bigFont(s)},!1,$)("selectionchange",function(s){return n.onMouseSelected(s)})},inputs:{current:"current"},decls:4,vars:2,consts:[[3,"current"],[1,"compact","files",2,"max-height","inherit"],["filesPanel",""],[3,"fileInfo","baseUrl","file-popup",4,"ngFor","ngForOf"],[3,"fileInfo","baseUrl","file-popup"]],template:function(t,n){t&1&&(u(0,"left-panel",0),l(1,"div",1,2),G(3,Fe,1,2,"file-item",3),a()),t&2&&(D("current",n.current),M(3),D("ngForOf",n.viewsFiles))},dependencies:[ee,R,ce,pe],styles:["[_nghost-%COMP%]{display:flex;height:inherit}.compact.files[_ngcontent-%COMP%]{padding-top:5px;display:grid;width:100%;grid-template-columns:repeat(auto-fill,200px);grid-template-rows:repeat(auto-fill,35px);grid-auto-flow:column;overflow-y:hidden;overflow-x:scroll}"]});let o=i;return o})();var ue=[{path:"**",component:ae}];var fe={providers:[re(ue)]};var me=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=_({type:i}),i.\u0275inj=b({imports:[m]});let o=i;return o})();var de=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=_({type:i}),i.\u0275inj=b({providers:[{provide:C,useValue:{baseUrl:"http://localhost:8080"}},{provide:d,useClass:d}],imports:[m,R,k,me]});let o=i;return o})();var he=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=f({type:i,selectors:[["app-root"]],standalone:!0,features:[X([{provide:Z,useValue:"/ui/"},{provide:d,useClass:d}]),P],decls:1,vars:0,template:function(t,n){t&1&&u(0,"router-outlet")},dependencies:[m,oe,de,k,se],styles:["[_nghost-%COMP%]{height:100%}"]});let o=i;return o})();ie(he,fe).catch(o=>console.error(o));
